{% extends "base.html" %}
{% load article_tags %}

{% block title %} articles {% endblock %}

{% block content %}
<div class="row text-center vertical-middle-sm">
    <h1>文章列表</h1>
    
    <p> 
    <form id="form1" action="{% url 'article:article_search' %}" method="POST" class="form-horizontal" role="form">{% csrf_token %}
    <!--<span style="margin-left:20px" class="glyphicon glyphicon-search"></span>-->
{{ search_form.keywords }}  按{{ search_form.by_which }}      开始日期{{ search_form.date_st }} 结束日期{{ search_form.date_ed }}

    </p>
     <p class="text-center">
            <a onclick="start_search({{ article.id }})" href="#"><span class="glyphicon glyphicon-search">开始搜索</span></a>
    </p>
</div>

<div>
</div>


<div class="container">
    {% for article in articles %}
        <div class="list-group">
            <a href="{{ article.get_url_path }}" class="list-group-item active">
                <h4 class="list-group-item-heading">{{ article.title }}</h4>
            </a>
                <p class="list-group-item-text">作者：<a href="{% url 'article:author_articles' article.author.username %}">{{ article.author }}</a></p>
                <p class="list-group-item-text">概要：{{ article.body|slice:'80'|linebreaks }}</p>
        </div>
    {% endfor %}

<strong>{% total_articles %}</strong> Articles Total,
{% include "paginator.html" %} 
</div>


<script type="text/javascript">
    function start_search(article_id){
         $.ajaxSetup({
      data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
 });
        $.ajax({
            url:"{% url 'article:article_search' %}",
            type:"POST",
            data: $('#form1').serialize(),
            success:function(r){
                e=r['status']
                if(e=="1"){
                layer.msg("感谢点赞");
                window.location.reload();
                }else if(e=="2"){
                layer.msg("我会继续努力");
                window.location.reload();
                }else{
                layer.msg("怎么了");
                window.location.assign(e);
}
        },
    });
}
</script>
{% endblock %}
